# ğŸ“Š Diagramas y Flujos del Sistema

Este documento contiene diagramas visuales detallados del sistema para facilitar la comprensiÃ³n de la arquitectura y flujos de trabajo.

---

## ğŸ“‹ Tabla de Contenidos

1. [Diagrama de Casos de Uso](#diagrama-de-casos-de-uso)
2. [Flujo de Usuario Completo](#flujo-de-usuario-completo)
3. [Diagrama de Base de Datos](#diagrama-de-base-de-datos)
4. [Flujo de AutenticaciÃ³n Detallado](#flujo-de-autenticaciÃ³n-detallado)
5. [Flujo de CotizaciÃ³n Completo](#flujo-de-cotizaciÃ³n-completo)
6. [Flujo de Pago](#flujo-de-pago)
7. [Diagrama de Despliegue](#diagrama-de-despliegue)

---

## 1. Diagrama de Casos de Uso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SISTEMA DE TALLER MECÃNICO                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚   GERENTE  â”‚                                                â”‚
â”‚  â”‚ (Manager)  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Gestionar Usuarios                                 â”‚
â”‚        â”‚    â””â”€ Crear, Editar, Eliminar usuarios                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Recibir VehÃ­culos                                  â”‚
â”‚        â”‚    â””â”€ Registrar vehÃ­culo y propietario                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Crear DiagnÃ³stico Inicial                          â”‚
â”‚        â”‚    â””â”€ Asignar tÃ©cnico                                 â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Gestionar Cotizaciones                             â”‚
â”‚        â”‚    â”œâ”€ Crear cotizaciÃ³n                                â”‚
â”‚        â”‚    â”œâ”€ Editar cotizaciÃ³n                               â”‚
â”‚        â”‚    â”œâ”€ Aprobar/Rechazar                                â”‚
â”‚        â”‚    â””â”€ Generar PDF                                     â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Gestionar Cuentas por Cobrar                       â”‚
â”‚        â”‚    â”œâ”€ Ver cuentas pendientes                          â”‚
â”‚        â”‚    â”œâ”€ Registrar pagos                                 â”‚
â”‚        â”‚    â””â”€ Generar recibos                                 â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Ver Reportes                                       â”‚
â”‚        â”‚    â”œâ”€ Reporte de ventas                               â”‚
â”‚        â”‚    â”œâ”€ Reporte por perÃ­odo                             â”‚
â”‚        â”‚    â””â”€ Exportar a PDF/Excel                            â”‚
â”‚        â”‚                                                        â”‚
â”‚        â””â”€â”€â–º Configurar Sistema                                 â”‚
â”‚             â”œâ”€ Datos del taller                                â”‚
â”‚             â”œâ”€ Impuestos y markup                              â”‚
â”‚             â””â”€ Usuarios y roles                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  TÃ‰CNICO   â”‚                                                â”‚
â”‚  â”‚(Technician)â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Ver DiagnÃ³sticos Asignados                         â”‚
â”‚        â”‚    â””â”€ Lista de vehÃ­culos asignados                    â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Crear DiagnÃ³stico TÃ©cnico                          â”‚
â”‚        â”‚    â”œâ”€ Describir problemas                             â”‚
â”‚        â”‚    â”œâ”€ Listar partes necesarias                        â”‚
â”‚        â”‚    â”œâ”€ Estimar horas de labor                          â”‚
â”‚        â”‚    â””â”€ Calcular costo total                            â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Actualizar Estado de DiagnÃ³stico                   â”‚
â”‚        â”‚    â””â”€ Marcar como completado                          â”‚
â”‚        â”‚                                                        â”‚
â”‚        â””â”€â”€â–º Ver Cotizaciones Relacionadas                      â”‚
â”‚             â””â”€ Ver cotizaciones de sus diagnÃ³sticos            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚   AMBOS    â”‚                                                â”‚
â”‚  â”‚   ROLES    â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Iniciar SesiÃ³n                                     â”‚
â”‚        â”‚    â””â”€ AutenticaciÃ³n con email/password                â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Recuperar ContraseÃ±a                               â”‚
â”‚        â”‚    â”œâ”€ Solicitar cÃ³digo                                â”‚
â”‚        â”‚    â”œâ”€ Verificar cÃ³digo                                â”‚
â”‚        â”‚    â””â”€ Cambiar contraseÃ±a                              â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Ver Lista de VehÃ­culos                             â”‚
â”‚        â”‚    â”œâ”€ Buscar vehÃ­culos                                â”‚
â”‚        â”‚    â”œâ”€ Filtrar por estado                              â”‚
â”‚        â”‚    â””â”€ Ver detalles                                    â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â–º Agregar Notas                                      â”‚
â”‚        â”‚    â””â”€ Comentarios en vehÃ­culos/diagnÃ³sticos           â”‚
â”‚        â”‚                                                        â”‚
â”‚        â””â”€â”€â–º Cerrar SesiÃ³n                                      â”‚
â”‚             â””â”€ Invalidar sesiÃ³n actual                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Flujo de Usuario Completo

### Journey del Cliente (Propietario del VehÃ­culo)

```
1. RECEPCIÃ“N
   Cliente llega al taller con vehÃ­culo
            â†“
   Gerente registra vehÃ­culo en sistema
   - Datos del vehÃ­culo (VIN, marca, modelo)
   - Datos del propietario
   - DescripciÃ³n del problema
   - Estado: "Recibido"
            â†“
            
2. DIAGNÃ“STICO INICIAL
   Gerente crea diagnÃ³stico inicial
   - Asigna tÃ©cnico
   - DescripciÃ³n general
   - Estado: "En DiagnÃ³stico"
            â†“
   TÃ©cnico recibe notificaciÃ³n
            â†“
            
3. DIAGNÃ“STICO TÃ‰CNICO
   TÃ©cnico inspecciona vehÃ­culo
   - Identifica problemas especÃ­ficos
   - Lista partes necesarias
   - Estima horas de trabajo
   - Calcula costos
   - Guarda diagnÃ³stico tÃ©cnico
            â†“
            
4. COTIZACIÃ“N
   Gerente crea cotizaciÃ³n basada en diagnÃ³stico
   - Agrega Ã­tems (partes, labor)
   - Calcula totales con impuestos
   - Genera PDF
   - EnvÃ­a a cliente por email/WhatsApp
            â†“
   Cliente revisa cotizaciÃ³n
            â†“
   
5A. COTIZACIÃ“N APROBADA
    Cliente acepta cotizaciÃ³n
            â†“
    Gerente marca como "Aprobado"
    Estado del vehÃ­culo: "En ReparaciÃ³n"
            â†“
    TÃ©cnico realiza reparaciÃ³n
            â†“
    Estado: "Completado"
            â†“
    
6. PAGO Y ENTREGA
   Gerente registra pago
   - Pago total o parcial
   - MÃ©todo de pago
   - Genera recibo
            â†“
   Si pago completo:
   - Estado de cuenta: "Pagado"
   - Entrega vehÃ­culo a cliente
            â†“
   Estado final: "Entregado"
   
5B. COTIZACIÃ“N RECHAZADA
    Cliente rechaza cotizaciÃ³n
            â†“
    Gerente marca como "Rechazado"
            â†“
    Opcional: Ajustar cotizaciÃ³n y reenviar
            â†“
    Si cliente no acepta: Devolver vehÃ­culo
```

---

## 3. Diagrama de Base de Datos (Inferido)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Users       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  UserId      â”‚
â”‚     Email       â”‚
â”‚     Password    â”‚â”€â”€â”
â”‚     Name        â”‚  â”‚
â”‚     LastName    â”‚  â”‚
â”‚     Role        â”‚  â”‚
â”‚     WorkshopId  â”‚  â”‚
â”‚     IsActive    â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  Workshops      â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ PK WorkshopId   â”‚â—„â”€â”˜
â”‚    Name         â”‚
â”‚    Address      â”‚
â”‚    Phone        â”‚
â”‚    Email        â”‚
â”‚    TaxId        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vehicles      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK VehicleId    â”‚â”€â”€â”
â”‚    VIN          â”‚  â”‚
â”‚    Make         â”‚  â”‚
â”‚    Model        â”‚  â”‚
â”‚    Year         â”‚  â”‚
â”‚    OwnerName    â”‚  â”‚
â”‚    OwnerPhone   â”‚  â”‚
â”‚    Status       â”‚  â”‚
â”‚    WorkshopId   â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  Diagnostics    â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ PK DiagnosticId â”‚  â”‚
â”‚ FK VehicleId    â”‚â—„â”€â”¤
â”‚ FK TechnicianId â”‚  â”‚
â”‚    Date         â”‚  â”‚
â”‚    Description  â”‚  â”‚
â”‚    Findings     â”‚  â”‚
â”‚    Status       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚            â”‚
        â”‚            â”‚
        â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TechnicianDiagnostics â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK TechDiagId        â”‚
â”‚ FK DiagnosticId      â”‚
â”‚ FK VehicleId         â”‚â—„â”˜
â”‚ FK TechnicianId      â”‚
â”‚    ProblemDesc       â”‚
â”‚    Diagnosis         â”‚
â”‚    RequiredParts (JSON)â”‚
â”‚    LaborHours        â”‚
â”‚    TotalCost         â”‚
â”‚    Status            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Estimates     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK EstimateId   â”‚â”€â”€â”
â”‚ FK VehicleId    â”‚  â”‚
â”‚ FK TechDiagId   â”‚  â”‚
â”‚    EstimateNum  â”‚  â”‚
â”‚    Date         â”‚  â”‚
â”‚    Status       â”‚  â”‚
â”‚    Subtotal     â”‚  â”‚
â”‚    Tax          â”‚  â”‚
â”‚    Total        â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚            â”‚
        â”‚            â”‚
        â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ EstimateItems   â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ PK ItemId       â”‚  â”‚
â”‚ FK EstimateId   â”‚â—„â”€â”˜
â”‚    Type         â”‚
â”‚    Description  â”‚
â”‚    Quantity     â”‚
â”‚    UnitPrice    â”‚
â”‚    Total        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        â”‚
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AccountsReceivable   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK AccountId         â”‚
â”‚ FK EstimateId        â”‚â”€â”€â”
â”‚    CustomerName      â”‚  â”‚
â”‚    TotalAmount       â”‚  â”‚
â”‚    PaidAmount        â”‚  â”‚
â”‚    BalanceDue        â”‚  â”‚
â”‚    Status            â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                          â”‚
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   Payments      â”‚       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚ PK PaymentId    â”‚       â”‚
â”‚ FK AccountId    â”‚â—„â”€â”€â”€â”€â”€â”€â”˜
â”‚    Date         â”‚
â”‚    Amount       â”‚
â”‚    Method       â”‚
â”‚    Reference    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Notes       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK NoteId       â”‚
â”‚ FK VehicleId    â”‚
â”‚ FK UserId       â”‚
â”‚    Content      â”‚
â”‚    CreatedAt    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WorkshopSettings â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK SettingId     â”‚
â”‚ FK WorkshopId    â”‚
â”‚    Name          â”‚
â”‚    Address       â”‚
â”‚    Phone         â”‚
â”‚    TaxId         â”‚
â”‚    Logo          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LaborTaxMarkupSettingsâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK SettingId         â”‚
â”‚ FK WorkshopId        â”‚
â”‚    TaxRate           â”‚
â”‚    LaborRate         â”‚
â”‚    PartsMarkup       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Flujo de AutenticaciÃ³n Detallado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚
â”‚ ingresa  â”‚
â”‚ email/pwdâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ValidaciÃ³n Client-Side     â”‚
â”‚  - Email vÃ¡lido?            â”‚
â”‚  - Password no vacÃ­o?       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ [VÃ¡lido]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/Users/login       â”‚
â”‚ { email, password }         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend API Handler       â”‚
â”‚   1. Buscar usuario         â”‚
â”‚   2. Verificar contraseÃ±a   â”‚
â”‚   3. Generar JWT            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–º [Error] Usuario no existe
     â”‚            â””â”€â–º 404 Not Found
     â”‚
     â”œâ”€â”€â–º [Error] ContraseÃ±a incorrecta
     â”‚            â””â”€â–º 401 Unauthorized
     â”‚
     â†“ [Success]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 200 OK             â”‚
â”‚ {                           â”‚
â”‚   token: "JWT...",          â”‚
â”‚   user: {                   â”‚
â”‚     id, email, name,        â”‚
â”‚     lastName, role          â”‚
â”‚   }                         â”‚
â”‚ }                           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend recibe respuesta   â”‚
â”‚ 1. Guardar token            â”‚
â”‚    localStorage.setItem()   â”‚
â”‚ 2. Guardar user data        â”‚
â”‚    AuthContext.login()      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Configurar Axios            â”‚
â”‚ Agregar token a headers:    â”‚
â”‚ Authorization: Bearer <JWT> â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigate("/home")           â”‚
â”‚ RedirecciÃ³n al dashboard    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProtectedRoute verifica:    â”‚
â”‚ - Token existe?             â”‚
â”‚ - Token vÃ¡lido?             â”‚
â”‚ - Rol correcto?             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–º [No autenticado]
     â”‚    â””â”€â–º Redirect("/login")
     â”‚
     â”œâ”€â”€â–º [Rol incorrecto]
     â”‚    â””â”€â–º Redirect("/unauthorized")
     â”‚
     â†“ [Autorizado]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render Dashboard/Home       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Flujo de CotizaciÃ³n Completo

```
INICIO
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gerente navega a /estimates    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EstimateList carga cotizacionesâ”‚
â”‚ GET /api/Estimates             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Click "Nueva CotizaciÃ³n"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigate to /estimate/new      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estimate Component inicializa  â”‚
â”‚ Carga datos necesarios:        â”‚
â”‚ - GET /api/Vehicles            â”‚
â”‚ - GET /api/TechDiagnostics     â”‚
â”‚ - GET /api/WorkshopSettings    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario selecciona vehÃ­culo    â”‚
â”‚ (Dropdown con bÃºsqueda)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auto-carga diagnÃ³stico tÃ©cnico â”‚
â”‚ Si existe diagnÃ³stico          â”‚
â”‚ - Pre-llena items de partes    â”‚
â”‚ - Pre-llena labor              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario agrega/edita items     â”‚
â”‚ Click "Agregar Item"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de Agregar Item          â”‚
â”‚ - Seleccionar tipo             â”‚
â”‚   â€¢ Parte                      â”‚
â”‚   â€¢ Labor                      â”‚
â”‚   â€¢ Servicio                   â”‚
â”‚ - Ingresar descripciÃ³n         â”‚
â”‚ - Ingresar cantidad            â”‚
â”‚ - Ingresar precio unitario     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ¡lculos automÃ¡ticos:          â”‚
â”‚ subtotal = qty Ã— unitPrice     â”‚
â”‚ tax = subtotal Ã— taxRate       â”‚
â”‚ total = subtotal + tax         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Item agregado a tabla          â”‚
â”‚ Recalcular totales generales   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ [Repetir para mÃ¡s items]
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Totales Finales:               â”‚
â”‚ Subtotal = Î£(item.subtotal)    â”‚
â”‚ IVA = subtotal Ã— 0.16          â”‚
â”‚ Descuento = subtotal Ã— %       â”‚
â”‚ Total = subtotal + IVA - desc  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario click "Guardar"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ValidaciÃ³n de datos:           â”‚
â”‚ - VehÃ­culo seleccionado?       â”‚
â”‚ - Al menos un item?            â”‚
â”‚ - Todos los precios vÃ¡lidos?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â”€â–º [Error] Mostrar mensaje
            â”‚            toast.error()
            â”‚
            â†“ [VÃ¡lido]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/Estimates            â”‚
â”‚ {                              â”‚
â”‚   vehicleId,                   â”‚
â”‚   estimateNumber,              â”‚
â”‚   items: [...],                â”‚
â”‚   subtotal, tax, total         â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend valida y guarda        â”‚
â”‚ - Guarda Estimate              â”‚
â”‚ - Guarda EstimateItems         â”‚
â”‚ - Crea AccountReceivable       â”‚
â”‚ - Retorna ID generado          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 201 Created           â”‚
â”‚ { id, estimateNumber, ... }    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ toast.success()                â”‚
â”‚ "CotizaciÃ³n creada exitosamente"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigate("/estimates")         â”‚
â”‚ Volver a lista de cotizaciones â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EstimateList se recarga        â”‚
â”‚ Nueva cotizaciÃ³n aparece       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Acciones disponibles:          â”‚
â”‚ - Ver PDF                      â”‚
â”‚ - Editar                       â”‚
â”‚ - Eliminar                     â”‚
â”‚ - Cambiar estado               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ [Ver PDF]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Abrir PDFModal                 â”‚
â”‚ - EstimatePDF renderiza        â”‚
â”‚ - Preview en pantalla          â”‚
â”‚ - OpciÃ³n de descargar          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
          FIN
```

---

## 6. Flujo de Pago

```
INICIO - Gerente en AccountsReceivable View
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lista de cuentas pendientes    â”‚
â”‚ GET /api/AccountReceivable     â”‚
â”‚ Muestra:                       â”‚
â”‚ - Cliente                      â”‚
â”‚ - Total                        â”‚
â”‚ - Pagado                       â”‚
â”‚ - Balance pendiente            â”‚
â”‚ - Estado                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario click "Registrar Pago" â”‚
â”‚ en una cuenta                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal de Registro de Pago      â”‚
â”‚ Pre-llena:                     â”‚
â”‚ - InformaciÃ³n del cliente      â”‚
â”‚ - Balance pendiente            â”‚
â”‚ - Historial de pagos previos   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario ingresa datos:         â”‚
â”‚ - Monto a pagar                â”‚
â”‚ - MÃ©todo de pago               â”‚
â”‚   â€¢ Efectivo                   â”‚
â”‚   â€¢ Tarjeta                    â”‚
â”‚   â€¢ Transferencia              â”‚
â”‚   â€¢ Cheque                     â”‚
â”‚ - NÃºmero de referencia (opt)   â”‚
â”‚ - Notas (opt)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ValidaciÃ³n:                    â”‚
â”‚ - Monto > 0?                   â”‚
â”‚ - Monto <= balance?            â”‚
â”‚ - MÃ©todo seleccionado?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â”€â–º [Error] Mostrar mensaje
            â”‚
            â†“ [VÃ¡lido]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario click "Confirmar Pago" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/AccountReceivable/   â”‚
â”‚      Payment                   â”‚
â”‚ {                              â”‚
â”‚   accountReceivableId,         â”‚
â”‚   amount,                      â”‚
â”‚   paymentMethod,               â”‚
â”‚   referenceNumber,             â”‚
â”‚   notes                        â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend procesa:               â”‚
â”‚ 1. Crear Payment record        â”‚
â”‚ 2. Actualizar AccountReceivableâ”‚
â”‚    - paidAmount += amount      â”‚
â”‚    - balanceDue -= amount      â”‚
â”‚ 3. Si balanceDue = 0:          â”‚
â”‚    - status = "Pagado"         â”‚
â”‚ 4. Si 0 < balanceDue < total:  â”‚
â”‚    - status = "Parcial"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 201 Created           â”‚
â”‚ { paymentId, ... }             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ toast.success()                â”‚
â”‚ "Pago registrado exitosamente" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cerrar modal                   â”‚
â”‚ Recargar lista de cuentas      â”‚
â”‚ Estado actualizado              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Opciones disponibles:          â”‚
â”‚ - Ver recibo de pago (PDF)     â”‚
â”‚ - Ver historial de pagos       â”‚
â”‚ - Registrar otro pago          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ [Ver Recibo]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generar PDF de recibo          â”‚
â”‚ Incluye:                       â”‚
â”‚ - Datos del taller             â”‚
â”‚ - Datos del cliente            â”‚
â”‚ - Monto pagado                 â”‚
â”‚ - MÃ©todo de pago               â”‚
â”‚ - Balance restante             â”‚
â”‚ - Firma/Sello                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
          FIN
```

---

## 7. Diagrama de Despliegue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENTE (Navegador)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Chrome     â”‚  â”‚   Firefox    â”‚  â”‚   Edge/Safari  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   React SPA (JavaScript)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTPS
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CDN / WEB SERVER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              IIS / Nginx / Apache                    â”‚ â”‚
â”‚  â”‚  Sirve:                                              â”‚ â”‚
â”‚  â”‚  - index.html                                        â”‚ â”‚
â”‚  â”‚  - assets/*.js (bundled React app)                  â”‚ â”‚
â”‚  â”‚  - assets/*.css (estilos)                           â”‚ â”‚
â”‚  â”‚  - images/                                           â”‚ â”‚
â”‚  â”‚  - web.config (redirect rules)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  UbicaciÃ³n:                                                â”‚
â”‚  - Desarrollo: http://localhost:5173                       â”‚
â”‚  - IIS: C:\inetpub\wwwroot\workshop                        â”‚
â”‚  - Azure: Static Web App                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTPS/API Calls
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND API SERVER                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              ASP.NET Core Web API                    â”‚ â”‚
â”‚  â”‚  Puerto: 5121                                        â”‚ â”‚
â”‚  â”‚  Endpoints:                                          â”‚ â”‚
â”‚  â”‚  - /api/Users/*                                      â”‚ â”‚
â”‚  â”‚  - /api/Vehicles/*                                   â”‚ â”‚
â”‚  â”‚  - /api/Diagnostics/*                                â”‚ â”‚
â”‚  â”‚  - /api/Estimates/*                                  â”‚ â”‚
â”‚  â”‚  - /api/AccountReceivable/*                          â”‚ â”‚
â”‚  â”‚  - /api/Reports/*                                    â”‚ â”‚
â”‚  â”‚  ...                                                 â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  Middleware:                                         â”‚ â”‚
â”‚  â”‚  - Authentication (JWT)                              â”‚ â”‚
â”‚  â”‚  - CORS                                              â”‚ â”‚
â”‚  â”‚  - Error Handling                                    â”‚ â”‚
â”‚  â”‚  - Logging                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  UbicaciÃ³n:                                                â”‚
â”‚  - Desarrollo: http://localhost:5121                       â”‚
â”‚  - ProducciÃ³n: https://api.j-benz.com                      â”‚
â”‚  - Azure: App Service                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ SQL Connection
                     â”‚ (Entity Framework Core)
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE SERVER                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Microsoft SQL Server                    â”‚ â”‚
â”‚  â”‚  Database: WorkshopDB                                â”‚ â”‚
â”‚  â”‚  Tables:                                             â”‚ â”‚
â”‚  â”‚  - Users                                             â”‚ â”‚
â”‚  â”‚  - Workshops                                         â”‚ â”‚
â”‚  â”‚  - Vehicles                                          â”‚ â”‚
â”‚  â”‚  - Diagnostics                                       â”‚ â”‚
â”‚  â”‚  - TechnicianDiagnostics                             â”‚ â”‚
â”‚  â”‚  - Estimates                                         â”‚ â”‚
â”‚  â”‚  - EstimateItems                                     â”‚ â”‚
â”‚  â”‚  - AccountsReceivable                                â”‚ â”‚
â”‚  â”‚  - Payments                                          â”‚ â”‚
â”‚  â”‚  - Notes                                             â”‚ â”‚
â”‚  â”‚  - WorkshopSettings                                  â”‚ â”‚
â”‚  â”‚  ...                                                 â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  Features:                                           â”‚ â”‚
â”‚  â”‚  - Backups automÃ¡ticos                               â”‚ â”‚
â”‚  â”‚  - ReplicaciÃ³n (opcional)                            â”‚ â”‚
â”‚  â”‚  - Logs de transacciones                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  UbicaciÃ³n:                                                â”‚
â”‚  - Desarrollo: localhost\SQLEXPRESS                        â”‚
â”‚  - ProducciÃ³n: Azure SQL Database                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVICIOS EXTERNOS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EmailJS (https://api.emailjs.com)                         â”‚
â”‚  - EnvÃ­o de emails de recuperaciÃ³n de contraseÃ±a           â”‚
â”‚  - EnvÃ­o de cotizaciones por email (opcional)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Arquitectura de ProducciÃ³n Recomendada

```
Internet
   â”‚
   â†“
[Load Balancer / Azure Front Door]
   â”‚
   â”œâ”€â”€â–º [Web Server 1] â”€â”
   â”‚                     â”‚
   â””â”€â”€â–º [Web Server 2] â”€â”¤
                        â”‚
                        â†“
                   [API Gateway]
                        â”‚
                        â”œâ”€â”€â–º [API Server 1] â”€â”
                        â”‚                     â”‚
                        â””â”€â”€â–º [API Server 2] â”€â”¤
                                             â”‚
                                             â†“
                                    [Database Cluster]
                                    Primary â†â†’ Secondary
                                             â”‚
                                             â†“
                                      [Backup Storage]
```

---

## ğŸ”’ Diagrama de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPAS DE SEGURIDAD                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. HTTPS / TLS                                         â”‚
â”‚     â””â”€ Cifrado en trÃ¡nsito                              â”‚
â”‚                                                         â”‚
â”‚  2. JWT Authentication                                  â”‚
â”‚     â”œâ”€ Token con expiraciÃ³n                             â”‚
â”‚     â”œâ”€ Firma digital (HMAC)                             â”‚
â”‚     â””â”€ Payload: { userId, role, exp }                   â”‚
â”‚                                                         â”‚
â”‚  3. Role-Based Access Control (RBAC)                    â”‚
â”‚     â”œâ”€ Manager: Full access                             â”‚
â”‚     â””â”€ Technician: Limited access                       â”‚
â”‚                                                         â”‚
â”‚  4. CORS Policy                                         â”‚
â”‚     â””â”€ Allow only frontend domain                       â”‚
â”‚                                                         â”‚
â”‚  5. Input Validation                                    â”‚
â”‚     â”œâ”€ Frontend validation (UI)                         â”‚
â”‚     â””â”€ Backend validation (API)                         â”‚
â”‚                                                         â”‚
â”‚  6. SQL Injection Protection                            â”‚
â”‚     â””â”€ Entity Framework (parametrized queries)          â”‚
â”‚                                                         â”‚
â”‚  7. XSS Protection                                      â”‚
â”‚     â”œâ”€ React auto-escapes                               â”‚
â”‚     â””â”€ Content Security Policy headers                  â”‚
â”‚                                                         â”‚
â”‚  8. Password Security                                   â”‚
â”‚     â”œâ”€ Bcrypt hashing                                   â”‚
â”‚     â””â”€ Minimum complexity requirements                  â”‚
â”‚                                                         â”‚
â”‚  9. Rate Limiting                                       â”‚
â”‚     â””â”€ Prevenir ataques de fuerza bruta                 â”‚
â”‚                                                         â”‚
â”‚  10. Logging & Monitoring                               â”‚
â”‚      â”œâ”€ Audit logs                                      â”‚
â”‚      â””â”€ Anomaly detection                               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Ãšltima actualizaciÃ³n**: Octubre 2025  
**VersiÃ³n**: 1.0  
